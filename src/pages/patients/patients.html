<!--
  Generated template for the PatientsPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-menu [content]="menuContent">
  <ion-content>
    <ion-list>
      <div id="menu-padding"></div>
      <button ion-item menuClose (click)="addPatient()">
        <ion-icon name="body" class="icon-menu"></ion-icon>Add patient
      </button>
      <button ion-item menuClose (click)="showGraph()">
        <ion-icon name="podium" class="icon-menu"></ion-icon>Show graph
      </button>
      <ion-item>
        <ion-label>
          <ion-icon name="settings" class="icon-menu"></ion-icon>Show only my patients
        </ion-label>
        <ion-toggle checked="false" [(ngModel)]="showOnlyMyPatients" (ionChange)="togglePatients()"></ion-toggle>
      </ion-item>
      <button ion-item menuClose (click)="aboutPage()">
        About
      </button>
    </ion-list>
  </ion-content>
</ion-menu>
<ion-nav #menuContent [root]="rootPage"></ion-nav>

<ion-header>
  <ion-navbar>
    <ion-title *ngIf="isAuthenticated">Hello, {{currentAuthenticatedUsername}}!</ion-title>
    <ion-title *ngIf="!isAuthenticated">Please log in</ion-title>

    <ion-buttons left>
      <button *ngIf="isAuthenticated" ion-button menuToggle><ion-icon name="menu"></ion-icon></button>
    </ion-buttons>

    <ion-buttons end>
      <button *ngIf="!isAuthenticated" ion-button icon-only (click)="login()">
        <ion-icon name="log-in"></ion-icon>
      </button>
      <button *ngIf="isAuthenticated" ion-button icon-only (click)="doFilter()">
        <ion-icon name="md-options"></ion-icon>
      </button>
      <button *ngIf="isAuthenticated" ion-button icon-only (click)="isSearchbarOpened=true">
        <ion-icon name="search"></ion-icon>
      </button>
      <button *ngIf="isAuthenticated" ion-button icon-only (click)="login()">
        <ion-icon name="log-out"></ion-icon>
      </button>      
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content>
    <ion-searchbar class="search-toolbar" (ionInput)="filterPatientList($event)" showCancelButton="true" placeholder="Search patients"*ngIf="isAuthenticated==true&&isSearchbarOpened" (ionCancel)="isSearchbarOpened=false"></ion-searchbar>
    <ion-list>
      <ion-item-sliding *ngFor="let patient of patients">
        <button ion-item (click)="viewPatient(patient)" text-wrap>
          <ion-avatar item-start>
            <ion-icon name="contact" class="icon-contact"></ion-icon>
          </ion-avatar>
          <h2>
            {{patient.LastName}}, {{patient.FirstName}}
          </h2>
          <div *ngIf="getSurgeryStatus(patient) == 0">
            <span class='patient-status'>
              <ion-icon name="warning" style='color:red'></ion-icon>
              {{getSurgerySummary(patient)}}
            </span>
          </div>
          <div *ngIf="getSurgeryStatus(patient) == 1">
              <span class='patient-status'>
                Surgery <span style='color:green'>{{getSurgeryStatusText(patient)}}</span>
                {{getSurgerySummary(patient)}}
              </span>
          </div>
          <div *ngIf="getSurgeryStatus(patient) == 2">
              <span class='patient-status'>
                Surgery <span style='color:blue'>{{getSurgeryStatusText(patient)}}</span>
                {{getSurgerySummary(patient)}}
              </span>
          </div>
          <div *ngIf="getSurgeryStatus(patient) == 3">
              <span class='patient-status'>
                Surgery <span style='color:blue'>{{getSurgeryStatusText(patient)}}</span>
                {{getSurgerySummary(patient)}}
              </span>
          </div>
          <div *ngIf="getSurgeryStatus(patient) == 4">
            <span class='patient-status'>
              <ion-icon name="warning" style='color:red'></ion-icon>
              Surgery <span style='color:red'>{{getSurgeryStatusText(patient)}}</span>
              {{getSurgerySummary(patient)}}
            </span>
          </div>
          <ion-note item-end>
              <ion-icon name="arrow-dropright" class="icon-right-arrow"></ion-icon>
          </ion-note>
        </button>

        <ion-item-options side="right">
          <button *ngIf="isWatchingPatient(patient)==false" ion-button (click)="watchPatient(patient)">
            Watch
          </button>
          <button *ngIf="isWatchingPatient(patient)==true"  ion-button color="secondary" (click)="unWatchPatient(patient)">
            Un-watch
          </button>
          <button ion-button color="danger" (click)="removePatientConfirm(patient)">
            Remove
          </button>
        </ion-item-options>
        
      </ion-item-sliding>
    </ion-list>
    

    <ion-fab bottom right >
      <button ion-fab (click)="addPatient()"> <ion-icon name="add"></ion-icon></button> 
    </ion-fab>

</ion-content>